# JPQL

- ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´
    - ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
    - SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • DB SQLì— ì˜ì¡´ X
    - JPQLì€ ê²°êµ­ SQLë¡œ ë³€í™˜ë¨

- ê¸°ë³¸ ë¬¸ë²•
    - select, update, delete ë¬¸ ì‚¬ìš©
        - insertëŠ” EntityManager.persist()ë¡œ
    - ì—”í‹°í‹° ì†ì„±(ex: Member, username) ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„
    - JPQL í‚¤ì›Œë“œ(ex: select, from ,as) ëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ X
    - ì—”í‹°í‹°ëª…ì„ í™œìš©í•´ ì¿¼ë¦¬
        - ì—”í‹°í‹°ëª…ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ í´ë˜ìŠ¤ëª…ì„ ê¸°ë³¸ ê°’ìœ¼ë¡œ
    - ë³„ì¹­(as)ë¥¼ í•„ìˆ˜ë¡œ ì‚¬ìš©í•´ì•¼ í•¨
        - ì•ˆì“°ë©´ ì˜¤ë¥˜
        - as í‚¤ì›Œë“œë¥¼ ê¼­ ì“°ì§„ ì•Šì•„ë„ ë¨

- TypeQuery, Query
    - TypeQuery : ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆì„ ë•Œ
        
        ```java
        TypedQuery<Member> query = em.createQuery("SELECT m FROM Member m", Member.class);
        
        List<Member> resultList = query.getResultList();
        for(Member member : resultList) {
        	System.out.println("member = " + member);
        }
        ```
        
    - Query : ë°˜í™˜ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ì—†ì„ ë•Œ
        
        ```java
        Query query = em.createQuery("SELECT m.username, m.age from Member m");
        List resultList = query.getResultList();
        
        for(Object o : resultList) {
        	Object[] result = (Object[]) o; //ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ Object[] ë°˜í™˜
        	System.out.println("username = " + result[0]);
        	System.out.println("age = " + result[1]);
        }
        ```
        
    - ê²°ê³¼ ì¡°íšŒ
        - query.getResultList
            - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜
        - query.getSingleResult
            - ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜ì¼ ë•Œ
            - ê²°ê³¼ê°€ ì—†ê±°ë‚˜ 2ê°œ ì´ìƒì´ë©´ ì˜ˆì™¸ ë°œìƒ

- íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
    - ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
        - íŒŒë¼ë¯¸í„°ë¥¼ ì´ë¦„ìœ¼ë¡œ êµ¬ë¶„
        - ì•ì— : ë¥¼ ì‚¬ìš©
        
        ```java
        String usernameParam = "User1";
        
        TypedQuery<Member> query = 
        	em.createQuery("SELECT m FROM Member m where m.uername = :username",
        		Member.class)
        		.setParameter("username", usernameParam)
        		.getResultList();
        
        // ë©”ì†Œë“œ ì²´ì¸ ë°©ì‹ ì•ˆì“¸ ë•Œ
        // query.setParameter("username", usernameParam);
        // List<Member> resultList = query.getResultList();
        ```
        
    - ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
        - ? ë‹¤ìŒì— ìœ„ì¹˜ê°’ì„ ì¤Œ
        
        ```java
        List<Member> members =
        	em.createQuery("SELECT m FROM Mebmer m where m.username = ?1",
        	Member.class)
        	.setParameter(1, usernameParam)
        	.getResultList();
        ```
        
    
    <aside>
    ğŸ’¡
    
    ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ëª…í™•
    
    </aside>
    
    - JDBC : ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë§Œ ì§€ì›
    - **JPQL : ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë„ ì§€ì›**
    

### í”„ë¡œì ì…˜

- Select ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
- select {í”„ë¡œì ì…˜ ëŒ€ìƒ} from ìœ¼ë¡œ ëŒ€ìƒì„ ì„ íƒ
    - í”„ë¡œì ì…˜ ëŒ€ìƒ : ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼
        - ì—”í‹°í‹°
            - ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬
            - ex) select m.team from Member m
        - ì„ë² ë””ë“œ íƒ€ì…
            - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ X
                - ì„ë² ë””ë“œ íƒ€ì…ì€ ê°’ íƒ€ì…ì´ê¸° ë•Œë¬¸ì— (ì—”í‹°í‹° íƒ€ì… X)
            - ì¡°íšŒì˜ ì‹œì‘ì ì´ ë  ìˆ˜ ì—†ìŒ
                - ex) Addressê°€ ì„ë² ë””ë“œ íƒ€ì…ì¼ ë•Œ
                - â€œselect a from Address aâ€ (X)
                - â€œselect o.address from Order oâ€ (O)
        - ìŠ¤ì¹¼ë¼ íƒ€ì…
            - ìˆ«ì, ë¬¸ì, ë‚ ì§œ ë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…
        - ì—¬ëŸ¬ ê°’ ì¡°íšŒ
            - í•„ìš”í•œ ë°ì´í„°ë§Œ ì„ íƒí•´ì„œ ì¡°íšŒ
            - Object[]ë¥¼ í™œìš©í•œ ì—¬ëŸ¬ í”„ë¡œì ì…˜ ì¡°íšŒ
                - ì‹¤ì œ ê°œë°œ ì‹œì—ëŠ” ì´ ë°©ë²•ë³´ë‹¤ DTO ì²˜ëŸ¼ ì˜ë¯¸ ìˆëŠ” ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ì‚¬ìš©
                
                ```java
                List<Object[]> resultList =
                	em.createQuery("SELECT m.username, m.age FROM Member m")
                	.getResultList();
                	
                for (Object[] row : resultList) {
                	String username = (String) row[0];
                	Integer age = (Integer) row[1];
                }
                ```
                
                ```java
                // ì—”í‹°í‹° íƒ€ì… ì¡°íšŒ
                List<Object[]> resultList =
                	em.createQuery("SELECT o.member, o.product, o.orderAmount FROM Order o")
                		.getResultList();
                	
                for (Object[] row : resultList) {
                	Member member = (Member) row[0]; // ì—”í‹°í‹°
                	Product product = (Product) row[1]; // ì—”í‹°í‹°
                	int orderAmount = (Integer) row[2]; // ìŠ¤ì¹¼ë¼
                }
                	
                ```
                
        
        - NEW ëª…ë ¹ì–´
            - íŒ¨í‚¤ì§€ ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª…ì„ ì…ë ¥
            - ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ìê°€ í•„ìš”
            
            ```java
            TypedQuery<UserDTO> query  = em.createQuery("SELECT new jpabook.jpql.UserDTO(m.username, m.age
            		FROM Member m", UserDTO.class);
            		
            List<UserDTO> resultList = query.getResultList();
            ```
